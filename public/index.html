<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
    <title>Welcome to Firebase Hosting</title>

    <!-- Firebase SDKs -->
    <script defer src="/__/firebase/11.0.2/firebase-app-compat.js"></script>
    <script defer src="/__/firebase/11.0.2/firebase-auth-compat.js"></script>
    <script defer src="/__/firebase/11.0.2/firebase-database-compat.js"></script>
    <script defer src="/__/firebase/11.0.2/firebase-firestore-compat.js"></script>
    <script defer src="/__/firebase/11.0.2/firebase-functions-compat.js"></script>
    <script defer src="/__/firebase/11.0.2/firebase-messaging-compat.js"></script>
    <script defer src="/__/firebase/11.0.2/firebase-storage-compat.js"></script>
    <script defer src="/__/firebase/11.0.2/firebase-analytics-compat.js"></script>
    <script defer src="/__/firebase/11.0.2/firebase-remote-config-compat.js"></script>
    <script defer src="/__/firebase/11.0.2/firebase-performance-compat.js"></script>
    <script defer src="/__/firebase/init.js?useEmulator=true"></script>
  </head>
  <body>
    <div>AGENT FORCE DEMO</div>
    <p id="load">Loading...</p>

    <!-- Salesforce Embedded Service Script -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const loadEl = document.querySelector("#load");

        // Initialize Firebase
        try {
          let app = firebase.app();
          let features = [
            "auth",
            "database",
            "firestore",
            "functions",
            "messaging",
            "storage",
            "analytics",
            "remoteConfig",
            "performance",
          ].filter((feature) => typeof app[feature] === "function");
          if (loadEl) {
            loadEl.textContent = `Firebase SDK loaded with ${features.join(", ")}`;
          } else {
            console.warn("#load element not found.");
          }
        } catch (e) {
          console.error(e);
          if (loadEl) {
            loadEl.textContent = "Error loading the Firebase SDK, check the console.";
          }
        }

        // Salesforce Embedded Service Initialization
        const initESW = function (scrt2URL) {
          if (window.embeddedservice_bootstrap) {
            console.log("Initializing Salesforce Embedded Messaging...");
            embeddedservice_bootstrap.init(
              "00DO8000007Bicp", // Salesforce Org ID
              "test_webservice", // Deployment Name
              "https://healthevolution--stackdevaf.sandbox.my.site.com/ESWtestwebservice1731958405344", // Base URL
              {
                scrt2URL: "https://healthevolution--stackdevaf.sandbox.my.salesforce-scrt.com", // Secure URL
              }
            );
            console.log("Salesforce Embedded Messaging initialized.");
            console.log('UPDATE 1');
          } else {
            console.error("embeddedservice_bootstrap is not defined.");
          }
        };

        const loadSalesforceScript = () => {
          const script = document.createElement("script");
          script.src =
            "https://healthevolution--stackdevaf.sandbox.my.site.com/ESWtestwebservice1731958405344/assets/js/bootstrap.min.js";
          script.onload = () => {
            console.log("Salesforce script loaded.");
            waitForEmbeddedService(() => {
              console.log("embeddedservice_bootstrap is now available:", window.embeddedservice_bootstrap);
              initESW("https://healthevolution--stackdevaf.sandbox.my.salesforce-scrt.com");
            });
          };
          script.onerror = () => {
            console.error("Failed to load the Salesforce Embedded Messaging script.");
          };
          document.body.appendChild(script);
        };

        const waitForEmbeddedService = (callback) => {
          const checkInterval = setInterval(() => {
            if (window.embeddedservice_bootstrap) {
              clearInterval(checkInterval);
              callback();
            }
          }, 100);
        };

        if (!window.embeddedservice_bootstrap) {
          loadSalesforceScript();
        } else {
          initESW("https://healthevolution--stackdevaf.sandbox.my.salesforce-scrt.com");
        }
      });
    </script>
  </body>
</html>
